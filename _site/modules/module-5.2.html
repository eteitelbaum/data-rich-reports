<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>PSC/DATS 2102–Summer Schedule - Module 5.2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../modules/module-5.1.html" rel="prev">
<link href="../images/dataviz-logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<meta property="og:title" content="PSC/DATS 2102–Summer Schedule - Module 5.2">
<meta property="og:description" content="Exploring Reactivity">
<meta property="og:site-name" content="PSC/DATS 2102--Summer Schedule">
<meta name="twitter:title" content="PSC/DATS 2102–Summer Schedule - Module 5.2">
<meta name="twitter:description" content="Exploring Reactivity">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Module 5.2</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/dataviz-logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://blackboard.gwu.edu" title="Blackboard" class="sidebar-tool px-1"><i class="bi bi-mortarboard-fill"></i></a>
    <a href="https://classroom.github.com" title="Github Classroom" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="https://posit.co/download/rstudio-desktop" title="RStudio Desktop" class="sidebar-tool px-1"><i class="bi bi-r-project"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Course information</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-syllabus.html" class="sidebar-item-text sidebar-link">Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-support.html" class="sidebar-item-text sidebar-link">Support</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../instructor.html" class="sidebar-item-text sidebar-link">Instructor</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Schedule</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-links.html" class="sidebar-item-text sidebar-link">Useful links</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Weekly Materials</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-1.html" class="sidebar-item-text sidebar-link">Week 1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../weeks/week-2.html" class="sidebar-item-text sidebar-link">Week 2</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Coding Assignments</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/coding-assignment-1.html" class="sidebar-item-text sidebar-link">Coding Assignment 1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/coding-assignment-2.html" class="sidebar-item-text sidebar-link">Coding Assignment 2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/coding-assignment-3.html" class="sidebar-item-text sidebar-link">Coding Assignment 3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/coding-assignment-4.html" class="sidebar-item-text sidebar-link">Coding Assignment 4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/coding-assignment-5.html" class="sidebar-item-text sidebar-link">Coding Assignment 5</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Project</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/project-assignment-1.html" class="sidebar-item-text sidebar-link">Project Assignment 1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/project-assignment-2.html" class="sidebar-item-text sidebar-link">Project Assignment 2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/project-assignment-3.html" class="sidebar-item-text sidebar-link">Project Assignment 3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/project-datasets.html" class="sidebar-item-text sidebar-link">Datasets</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Course Modules</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/getting-started.html" class="sidebar-item-text sidebar-link">Getting Started</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-1.1.html" class="sidebar-item-text sidebar-link">Module 1.1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-1.2.html" class="sidebar-item-text sidebar-link">Module 1.2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-2.1.html" class="sidebar-item-text sidebar-link">Module 2.1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-2.2.html" class="sidebar-item-text sidebar-link">Module 2.2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-3.1.html" class="sidebar-item-text sidebar-link">Module 3.1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-3.2.html" class="sidebar-item-text sidebar-link">Module 3.2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-4.1.html" class="sidebar-item-text sidebar-link">Module 4.1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-4.2.html" class="sidebar-item-text sidebar-link">Module 4.2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-5.1.html" class="sidebar-item-text sidebar-link">Module 5.1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../modules/module-5.2.html" class="sidebar-item-text sidebar-link active">Module 5.2</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#ui" id="toc-ui" class="nav-link" data-scroll-target="#ui">UI</a></li>
  <li><a href="#server" id="toc-server" class="nav-link" data-scroll-target="#server">Server</a></li>
  <li><a href="#call-to-shiny-app" id="toc-call-to-shiny-app" class="nav-link" data-scroll-target="#call-to-shiny-app">Call to Shiny app</a></li>
  <li><a href="#helper-script" id="toc-helper-script" class="nav-link" data-scroll-target="#helper-script">Helper script</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/eteitelbaum/dataviz-summer-2023/edit/main/modules/module-5.2.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/eteitelbaum/dataviz-summer-2023/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">Module 5.2</h1>
<p class="subtitle lead">Exploring Reactivity</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Prework
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Get a <a href="https://fred.stlouisfed.org/docs/api/api_key.html">FRED API key</a>
</li>
<li>Install <a href="https://cran.r-project.org/web/packages/fredr/vignettes/fredr.html">fredr</a> and read about its basic usage</li>
<li>Install <a href="https://cran.r-project.org/web/packages/ecm/ecm.pdf">ecm</a>, which we will use to build our recession shading helper script</li>
<li>Install <a href="https://dreamrs.github.io/shinyWidgets/">shinyWidgets</a> and familiarize yourself with its basic functions</li>
<li>Start a new Shiny project for this lesson. Go to File, select New Directory and then Shiny App. Browse to where you want to save the app, give the directory a name and click Create Project.</li>
</ul>
</div>
</div>
<section id="overview" class="level2"><h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>A fundmental concept in R Shiny is reactivity. Reactivity refers to the automatic responsiveness and dynamic behavior of the application based on user input and data changes. It allows the application to update and re-render specific parts of the user interface (UI) in response to changes in input values, data updates, or other reactive triggers.</p>
<p>All Shiny apps have an element of reactivity. In a basic Shiny app like we say in the last module, reactivity occurs when user input is fed to the server function through functions like <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> or <code><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">renderTable()</a></code>. But we might also want to add additional elements of reactivity by using reactive functions like <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> or <code><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe()</a></code>. In this lesson, we are going to look at how to use the <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> function to control two separate reactive inputs to a line chart: the indicator the user wishes to view and the date range that the way to view it for. Here is the app that we are going to be building:</p>
<iframe src="https://emmanuelteitelbaum.shinyapps.io/fred_app/" width="780" height="560" data-external="1">
</iframe>
</section><section id="setup" class="level2"><h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="quarto-video ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/wo9vZccmqwc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>In the setup portion of our we want to start by loading the packages we will need to build the app. For this app, we are going to be using the <code>fredr</code> package to download data pertaining to the overall health of the economy from the St.&nbsp;Louis Fed API (FRED). So here we will also set our FRED API key and assign the codes for the indicators that we want to download to objects.</p>
<p>Next, we will use the <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> function to set the start date of our line series to Januar 1, 1970 and the end date as today’s date (system date). We will also create a list of variable names for our UI dropdown (<code>vars</code>) and relate them to the objects containing the indicator codes.</p>
<p>Finally, we are going to be using a helper function to generate recession shading for our charts. Scroll down to the bottom of this page to see the code for the helper function. Take this and save it in an R file and put it in your app folder. In this chunk, we are going to call it with the source function, e.g.&nbsp;<code>source(helper.R)</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sboysel/fredr">fredr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set Fred API key </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/fredr/man/fredr-key.html">fredr_set_key</a></span><span class="op">(</span><span class="st">"YOUR FRED API KEY"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Assign FRED series to objects</span></span>
<span><span class="va">cci</span> <span class="op">&lt;-</span> <span class="st">"CSCICP03USM665S"</span> <span class="co"># consumer confidence</span></span>
<span><span class="va">bci</span> <span class="op">&lt;-</span> <span class="st">"BSCICP03USM665S"</span> <span class="co"># business confidence</span></span>
<span><span class="va">cli</span> <span class="op">&lt;-</span> <span class="st">"USALOLITONOSTSAM"</span> <span class="co"># composite lead indicator</span></span>
<span><span class="va">unemp_rate</span> <span class="op">&lt;-</span> <span class="st">"UNRATE"</span> <span class="co"># unemployment rate</span></span>
<span><span class="va">growth</span> <span class="op">&lt;-</span> <span class="st">"A191RL1Q225SBEA"</span> <span class="co"># growth rate</span></span>
<span></span>
<span><span class="co"># set start and end date</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1970-01-01"</span><span class="op">)</span></span>
<span><span class="va">end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create list of named values for the input selection</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Consumer Confidence"</span> <span class="op">=</span> <span class="va">cci</span>, </span>
<span>          <span class="st">"Business Confidence"</span> <span class="op">=</span> <span class="va">bci</span>, </span>
<span>          <span class="st">"Composite Indicator"</span> <span class="op">=</span> <span class="va">cli</span>, </span>
<span>          <span class="st">"Unemployment Rate"</span> <span class="op">=</span> <span class="va">unemp_rate</span>,</span>
<span>          <span class="st">"Growth Rate"</span> <span class="op">=</span> <span class="va">growth</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load helper script</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"helper.R"</span><span class="op">)</span> <span class="co"># scroll down, code pasted below</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="ui" class="level2"><h2 class="anchored" data-anchor-id="ui">UI</h2>
<div class="quarto-video ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/wo9vZccmqwc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Now we can get started on developing the UI for our app. For this app, we are going to have a title panel and two main display elements. The first is a panel where the user can select the indicator that they want to chart and the second is a plot with a slider where users can select the years they want to view. So let’s divide the UI into two sections using the <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow()</a></code> and <code><a href="https://rdrr.io/pkg/shiny/man/column.html">column()</a></code></p>
<p>The <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow()</a></code> function creates horizontal containers while the <code><a href="https://rdrr.io/pkg/shiny/man/column.html">column()</a></code> function is used to create vertical containers. Since we our app is going to display a single row, we will have just one <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow()</a></code> call. Then we can divide that row into two columns using the <code><a href="https://rdrr.io/pkg/shiny/man/column.html">column()</a></code> function. The first argument in <code><a href="https://rdrr.io/pkg/shiny/man/column.html">column()</a></code>is the column width. Since column widths in Shiny are based on the Boots Bootstrap 12-wide grid system, our column widths must add up to 12. So let’s make our panel for selecting the indicator 4 units wide and the area where we will display the plot 8 units wide.</p>
<p>From there, we can define the panel as a <code><a href="https://rdrr.io/pkg/shiny/man/wellPanel.html">wellPanel()</a></code> to give it an inset look and a grey background. We include <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code> to get our dropdown where users can select an indicator from the <code>vars</code> list. Let’s also use the <code><a href="https://rdrr.io/pkg/shiny/man/helpText.html">helpText()</a></code> function to display some instructions regarding how to use the app.</p>
<p>For the main display section, we are going to have our plot out along with the slider input. We are going to call this input “range” and leave the label blank. Then we need to define a min value, a max value and a range for the slider. For <code>min</code> and <code>max</code>, we will use <code>start_date</code> and <code>end_date</code>, which we defined earlier in the setup and the combination of these to define the range (<code>value</code>). Then we set <code>width</code> to 100% because we want the slider to expand to fit the entire width of the plot. `</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span></span>
<span>    <span class="co"># Application title</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"FRED Data App"</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span></span>
<span>      </span>
<span>      <span class="co"># 12 columns on one row: this panel will take 1/3 of it</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/wellPanel.html">wellPanel</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span><span class="st">"indicator"</span>, <span class="st">"Indicator:"</span>, <span class="va">vars</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/helpText.html">helpText</a></span><span class="op">(</span><span class="st">"Select an indicator, choose a date range and view the trend. </span></span>
<span><span class="st">               The grey bars represent economic recessions. </span></span>
<span><span class="st">               The data for this app comes from the St. Louis Fed's </span></span>
<span><span class="st">               FRED database. The consumer confidence, business confidence and </span></span>
<span><span class="st">               lead composite indicators are OECD data downloaded through FRED."</span><span class="op">)</span></span>
<span>      <span class="op">)</span>, </span>
<span>      </span>
<span>      <span class="co"># Remaining 2/3 occupied by plot</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span><span class="fl">8</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"lineChart"</span><span class="op">)</span>,     </span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span></span>
<span>          <span class="st">"range"</span>,</span>
<span>          <span class="st">""</span>,</span>
<span>          min <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>          max <span class="op">=</span> <span class="va">end_date</span>, </span>
<span>          value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">start_date</span>, <span class="va">end_date</span><span class="op">)</span>, </span>
<span>          width <span class="op">=</span> <span class="st">"100%"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="server" class="level2"><h2 class="anchored" data-anchor-id="server">Server</h2>
<div class="quarto-video ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/wo9vZccmqwc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>For our server function, we are going to define two separate <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive()</a></code> functions. This is how we are going to dynamically update the plot based on two different user inputs. First, we will define an input for the indicator where <code>input$indicator</code> takes the user input from the dropdown menu to perform a fresh API call whenever the selected indicator changes. Then, we take that input and filter it based on the input from the slider, e.g.&nbsp;<code>input$range</code>. Then we render the plot based on these updated data.</p>
<p>Notice that whenever we want to use the stored data from the reactive calls we need to add parentheses after the objects, e.g.&nbsp;<code>fred_indicator()</code> in the second reactive function or <code>fred_data()</code> in the <code>ggplot</code> call. This is to ensure that the reactive expression is evaluated and its current value is used as the input data for the plot.</p>
<p>Finally, we are going to use the <code>add_rec_shade()</code> helper function to add the recession shading to the chart. We again use the inputs from the two reactive functions to define the start date and end date of the shading as well as the y-min and y-max values of the shaded rectangles.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>    <span class="co"># Download data from FRED with reactive function. </span></span>
<span>    <span class="co"># Only updates when user selects new indicator</span></span>
<span>    <span class="va">fred_indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/fredr/man/fredr.html">fredr</a></span><span class="op">(</span>series_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">indicator</span>,</span>
<span>        observation_start <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>        observation_end <span class="op">=</span> <span class="va">end_date</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="co"># Filter data according to chosen years </span></span>
<span>    <span class="co"># Only updates when user selects new data range</span></span>
<span>    <span class="va">fred_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">fred_indicator</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">input</span><span class="op">$</span><span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">input</span><span class="op">$</span><span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span>   <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Render line chart</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">lineChart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      </span>
<span>      <span class="co"># Build plot with ggplot2</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">fred_data</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"navyblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>          x <span class="op">=</span> <span class="st">""</span>, </span>
<span>          y <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">vars</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">indicator</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="co"># add recession shading</span></span>
<span>        <span class="fu">add_rec_shade</span><span class="op">(</span>st_date <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                      ed_date <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                      shade_color <span class="op">=</span> <span class="st">"darkgrey"</span>,</span>
<span>                      y_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">fred_data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>,</span>
<span>                      y_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">fred_data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="call-to-shiny-app" class="level2"><h2 class="anchored" data-anchor-id="call-to-shiny-app">Call to Shiny app</h2>
<p>Once we have our UI and server functions defined we are ready to go. But don’t forget to include the call to the Shiny app or the app won’t run! Once this is in place, you can click “Run App” in the RStudio IDE to view the app locally. Optionally, right now, you can try setting up an account on <a href="https://www.shinyapps.io/">shinyapps.io</a> and try publishing your app on their server.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># See above for the definitions of ui and server</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span></span>
<span><span class="co"># Run the application </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="helper-script" class="level2"><h2 class="anchored" data-anchor-id="helper-script">Helper script</h2>
<p>This is the helper script for shaded recession rectangles. Save in a file called <code>helper.R</code> in same folder as your <code>app.R</code> file. See <a href="https://rpubs.com/FSl/609471">this post</a> for more details.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaurbans/ecm">ecm</a></span><span class="op">)</span> <span class="co"># forlagpad</span></span>
<span></span>
<span><span class="co"># define add_rec_shade function</span></span>
<span><span class="va">add_rec_shade</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">st_date</span>,<span class="va">ed_date</span>,<span class="va">shade_color</span>, <span class="va">y_min</span>, <span class="va">y_max</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># download NBER recession indicators, peak through trough</span></span>
<span>  <span class="va">recession</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fredr/man/fredr.html">fredr</a></span><span class="op">(</span>series_id <span class="op">=</span> <span class="st">"USRECD"</span>,</span>
<span>                    observation_start <span class="op">=</span> <span class="va">st_date</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">st_date</span><span class="op">)</span>, </span>
<span>                    observation_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">ed_date</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#code 1 for 1st day of recession, -1 for 1st day after it ends</span></span>
<span>  <span class="va">recession</span><span class="op">$</span><span class="va">diff</span><span class="op">&lt;-</span><span class="va">recession</span><span class="op">$</span><span class="va">value</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/ecm/man/lagpad.html">lagpad</a></span><span class="op">(</span><span class="va">recession</span><span class="op">$</span><span class="va">value</span>,k<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#drop 1st N.A. value</span></span>
<span>  <span class="va">recession</span><span class="op">&lt;-</span><span class="va">recession</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">recession</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span>,<span class="op">]</span> </span>
<span>  </span>
<span>  <span class="co">#create vector of recession start dates</span></span>
<span>  <span class="va">recession.start</span><span class="op">&lt;-</span><span class="va">recession</span><span class="op">[</span><span class="va">recession</span><span class="op">$</span><span class="va">diff</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span><span class="op">$</span><span class="va">date</span> </span>
<span>  </span>
<span>  <span class="co">#create vector of recession end dates</span></span>
<span>  <span class="va">recession.end</span><span class="op">&lt;-</span><span class="va">recession</span><span class="op">[</span><span class="va">recession</span><span class="op">$</span><span class="va">diff</span><span class="op">==</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="op">]</span><span class="op">$</span><span class="va">date</span> </span>
<span>  </span>
<span>  <span class="co"># if there are more dates listed in recession.start than recession.end</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">recession.start</span><span class="op">)</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">recession.end</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># then enter system date for last date in recession.end</span></span>
<span>  <span class="op">{</span><span class="va">recession.end</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">recession.end</span>,<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> </span>
<span>  </span>
<span>  <span class="co"># if there are more dates listed in recession.end than recession.start</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">recession.end</span><span class="op">)</span><span class="op">&gt;</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">recession.start</span><span class="op">)</span><span class="op">)</span>       </span>
<span>  <span class="co"># then enter the earliest date in recession$date as first date in recession.start  </span></span>
<span>  <span class="op">{</span><span class="va">recession.start</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">recession</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,<span class="va">recession.start</span><span class="op">)</span><span class="op">}</span> </span>
<span>  </span>
<span>  <span class="co"># make a dataframe out of recession.start and recession.end</span></span>
<span>  <span class="va">recs</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">recession.start</span>,<span class="va">recession.end</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># convert recession.start into a date</span></span>
<span>  <span class="va">recs</span><span class="op">$</span><span class="va">recession.start</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">recs</span><span class="op">$</span><span class="va">recession.start</span><span class="op">)</span>,</span>
<span>    origin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1970-01-01"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span>  <span class="co"># convert recession.end into a date</span></span>
<span>  <span class="va">recs</span><span class="op">$</span><span class="va">recession.end</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span></span>
<span>    <span class="va">recs</span><span class="op">$</span><span class="va">recession.end</span>,</span>
<span>    origin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1970-01-01"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># if the number of rows in recs &gt; 0</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> </span>
<span>  <span class="co"># draw the rectangle  </span></span>
<span>  <span class="op">{</span><span class="va">rec_shade</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">recs</span>, </span>
<span>                         <span class="co"># inherit.aes=F overrides default aesthetics</span></span>
<span>                         inherit.aes<span class="op">=</span><span class="cn">F</span>, </span>
<span>                         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="va">recession.start</span>, </span>
<span>                         xmax<span class="op">=</span><span class="va">recession.end</span>, </span>
<span>                         ymin<span class="op">=</span><span class="va">y_min</span>, ymax<span class="op">=</span><span class="va">y_max</span><span class="op">)</span>, </span>
<span>                         fill<span class="op">=</span><span class="va">shade_color</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">rec_shade</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/dataviz-gwu\.rocks/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../modules/module-5.1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Module 5.1</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2023, <a href="https://emmanuel.teitelbaum.com">Emmanuel Teitelbaum</a></div>   
    <div class="nav-footer-right">This page is built with <a href="https://quarto.org/">Quarto</a>. 👷🛠️</div>
  </div>
</footer>


</body></html>