{
  "hash": "d217b013fa6c0644bebdee3221854ad2",
  "result": {
    "markdown": "---\ntitle: \"Module 3.1\"\nsubtitle: \"Choropleth Maps\"\nformat: html\nhighlight-style: atom-one\nexecute:\n  echo: true\n  message: false\n  warning: false\n---\n\n\n## Grabbing country shapes from rnaturalearth\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\nlibrary(dplyr)\n\nworld_map_df <- ne_countries(scale = \"medium\", returnclass = \"sf\") |> \n    filter(iso_a3 != \"ATA\") # remove Antarctica\n\n#world_map_df |>\n  # select and view first 10 columns\n  #select(1:10) |> \n  #glimpse()\n\nworld_map_df |>\n  select(geometry) # view contents of last column of df (geometry)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 232 features and 0 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -180 ymin: -58.49229 xmax: 180 ymax: 83.59961\nCRS:           +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\nFirst 10 features:\n                         geometry\n1  MULTIPOLYGON (((31.28789 -2...\n2  MULTIPOLYGON (((30.39609 -1...\n3  MULTIPOLYGON (((53.08564 16...\n4  MULTIPOLYGON (((104.064 10....\n5  MULTIPOLYGON (((-60.82119 9...\n6  MULTIPOLYGON (((12.43916 41...\n7  MULTIPOLYGON (((166.7458 -1...\n8  MULTIPOLYGON (((70.94678 42...\n9  MULTIPOLYGON (((-53.37061 -...\n10 MULTIPOLYGON (((162.9832 5....\n```\n:::\n:::\n\n\n## Make a map with geom_sf()\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(data = world_map_df) +\n  geom_sf(aes(fill = as.factor(income_grp))) + \n  labs(title = \"World Bank country income categories\")\n```\n\n::: {.cell-output-display}\n![](module-3.1_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n## Beautify your map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggthemes)\n\nggplot(data = world_map_df) +\n  geom_sf(aes(fill = as.factor(income_grp))) + \n  labs(\n    title = \"Population, most recent available estimate\",\n    fill = \"Category\"\n    ) +\n    theme_map() + \n    scale_fill_viridis_d()\n```\n\n::: {.cell-output-display}\n![](module-3.1_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Merging rnaturalearth with other data\n\nWe are going to use iso2c to do the merge\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(wbstats)\n\noil_rents_df <- wb_data(c(oil_rents_gdp = \"NY.GDP.PETR.RT.ZS\"), mrnev = 1) \n\nrents_map_df <- left_join(world_map_df, oil_rents_df, join_by(iso_a2 == iso2c))\n\nrents_map_df |>\n  select(last_col(5):last_col()) |> #select last 5 columns of df\n  glimpse() \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 232\nColumns: 6\n$ date          <dbl> 2020, 2020, 2018, 2020, 2014, NA, 2020, 2020, 2020, 2020…\n$ oil_rents_gdp <dbl> 0.0000000, 0.0000000, 4.5313107, 0.6775696, 11.3636580, …\n$ obs_status    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ footnote      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ last_updated  <date> 2023-03-01, 2023-03-01, 2023-03-01, 2023-03-01, 2023-03…\n$ geometry      <MULTIPOLYGON [°]> MULTIPOLYGON (((31.28789 -2..., MULTIPOLYGO…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = rents_map_df) +\n  geom_sf(aes(fill = oil_rents_gdp)) + # change var\n  labs(\n    title = \"Oil rents as a % of GDP\", # change title\n    subtitle = \"(Most recent available data)\", # add subtitle\n    fill = \"Category\", # change legend title\n    caption = \"Source: World Bank Development Indicators\"\n    ) +\n  theme_map() +\n  theme(legend.position = \"right\") +\n  scale_fill_viridis_c( # chg from discrete (_d) to continuous (_c)\n      option = \"magma\", #  chg to magma theme\n      labels = scales::label_percent(scale = 1) # add percent label for legend\n      ) \n```\n\n::: {.cell-output-display}\n![](module-3.1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Build your map in one long pipe sequence\n\n- change indicator to illustrate ease of making map when code is finished, maybe build an exercise based on that \n\n\n::: {.cell}\n\n```{.r .cell-code}\nne_countries(scale = \"medium\", returnclass = \"sf\") |> \n  left_join(\n    wb_data(\n      c(oil_rents_gdp = \"NY.GDP.PETR.RT.ZS\"), \n      mrnev = 1\n    ),\n    join_by(iso_a2 == iso2c)\n  ) |> \n  filter(iso_a3 != \"ATA\") |>  # remove Antarctica\n  ggplot(aes(fill = oil_rents_gdp)) +\n  geom_sf() +\n  labs(\n    title = \"Oil rents as a % of GDP\", # change title\n    subtitle = \"(Most recent available data)\", # add subtitle\n    fill = \"Category\", # change legend title\n    caption = \"Source: World Bank Development Indicators\"\n    ) +\n  theme_map() +\n  theme(legend.position=\"right\") +\n  scale_fill_viridis_c( # chg from discrete (_d) to continuous (_c)\n    option = \"magma\", #  chg to magma theme\n    labels = scales::label_percent(scale = 1) # add percent label for legend\n    )\n```\n\n::: {.cell-output-display}\n![](module-3.1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "module-3.1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}